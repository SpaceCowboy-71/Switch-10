<html lang="en">
  <head>
    <link rel="stylesheet" href="style_pummel.css" />
    <!-- Bootstrap Icons -->
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css"
    />
    <!-- Bootstrap CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC"
      crossorigin="anonymous"
    />
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"></script>
  </head>
  <body>
    <div class="container my-5">
      <h1 class="text-white">Switch-10</h1>
      <h5 class="text-white"><i>Can you solve this riddle?</i></h5>

      <div class="text-white">
        <p>
          There are 11 slots and 10 tokens (5 in each color, placed on opposite
          sides).<br />
          The goal is to switch places between the two colors. <br />
          You can click on a token to move it towards the opposite side. <br />
        </p>
        <p>The rules:</p>
        <ol type="1">
          <li>
            Each token is only allowed to move forward (i.e., the opposite
            direction).
          </li>
          <li>
            Each token can only move one slot at a time or jump over one peg.
          </li>
        </ol>
      </div>

      <div id="board" class="btn-group"></div>
      <br />

      <div class="btn-group my-3">
        <button type="button" class="btn btn-light" onclick="location.reload()">
          <span class="bi-arrow-clockwise"></span>
          Restart
        </button>
        <button
          id="btn-undo"
          type="button"
          class="btn btn-outline-light"
          onclick="undo()"
        >
          <span class="bi-arrow-90deg-left"></span>
          Undo
        </button>
      </div>
    </div>
    <!-- Corner Button -->
    <div id="corner-triangle">
      <div class="corner-triangle-text text-capitalize">
        <a href="https://github.com/SpaceCowboy-71" target="_blank"
          ><span class="corner-triangle-firstline">My</span><br />GitHub!</a
        >
      </div>
    </div>
    <!-- Modal -->
    <div class="modal fade" id="winModal" tabindex="-1" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h1 class="modal-title fs-5">Congratulations, you did it!</h1>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
            ></button>
          </div>
          <div class="modal-body">
            <img src="images/Jigglypuff_SSB4.webp" alt="" />
          </div>
          <div class="modal-footer">
            <button
              type="button"
              class="btn btn-primary"
              data-bs-dismiss="modal"
              onclick="location.reload()"
            >
              Restart
            </button>
          </div>
        </div>
      </div>
    </div>
    <!-- Bootstrap JS Bundle with Popper -->
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
      crossorigin="anonymous"
    ></script>
  </body>

  <script>
    var board = document.getElementById("board");
    const colors = ["BlueViolet", "LightPink"];
    const bg_color = "transparent";
    var boardState = [];
    for (var i = 0; i < 11; i++) {
      if (i < 5) {
        boardState[i] = colors[0];
      } else if (i > 5) {
        boardState[i] = colors[1];
      } else {
        boardState[i] = bg_color;
      }
    }
    var winState = [];
    for (var i = 0; i < 11; i++) {
      if (i < 5) {
        winState[i] = colors[1];
      } else if (i > 5) {
        winState[i] = colors[0];
      } else {
        winState[i] = bg_color;
      }
    }
    var boardStateHistory = [];
    addHistory();
    initBoard();
    toggleUndoButton(false);

    function initBoard() {
      for (var i = 0; i < 11; i++) {
        var slot = document.createElement("button");
        slot.id = i;
        slot.className = "btn btn-outline-light slot";
        slot.onclick = function () {
          clickSlot(this);
        };
        board.appendChild(slot);
      }
      updateBoard();
    }

    function updateBoard() {
      //console.log(boardState);
      for (var i = 0; i < 11; i++) {
        var slot = document.getElementById(i);
        slot.style.backgroundColor = boardState[i];
      }
      checkWin();
    }

    function clickSlot(slot) {
      moveToken(slot);
    }

    function moveToken(slot) {
      var slotId = parseInt(slot.id);
      var slotColor = boardState[slotId];
      var direction = slotColor == colors[0] ? 1 : -1;
      var nextSlot = slotId + direction;
      //console.log("next slot: " + nextSlot);
      if (boardState[nextSlot] == bg_color) {
        boardState[nextSlot] = slotColor;
        boardState[slotId] = bg_color;
        updateBoard();
        addHistory();
      } else {
        var nextNextSlot = nextSlot + direction;
        //console.log("next next slot: " + nextNextSlot);
        if (boardState[nextNextSlot] == bg_color) {
          boardState[nextNextSlot] = slotColor;
          boardState[slotId] = bg_color;
          updateBoard();
          addHistory();
        }
      }
    }

    function addHistory() {
      boardStateHistory.push(boardState.slice());
      console.log(boardStateHistory);
      toggleUndoButton(true);
    }

    function undo() {
      if (boardStateHistory.length > 1) {
        boardStateHistory.pop();
        console.log(boardStateHistory);
        boardState = boardStateHistory[boardStateHistory.length - 1].slice();
        updateBoard();
      }
      if (boardStateHistory.length == 1) {
        toggleUndoButton(false);
      }
    }

    function toggleUndoButton(enable) {
      if (enable) {
        document.getElementById("btn-undo").disabled = false;
      } else {
        document.getElementById("btn-undo").disabled = true;
      }
    }

    function checkWin() {
      if (JSON.stringify(boardState) == JSON.stringify(winState)) {
        //alert("You win!");
        var myModal = new bootstrap.Modal(document.getElementById("winModal"));
        myModal.toggle();
      }
    }
  </script>
</html>
